<script>
function initMap() {
  var urlArray = window.location.href.split("/")
  var urlID = urlArray[urlArray.length - 1]
  $.get("/api/beacons/" + urlID,).then(
    function(foundBeacon) {
      console.log(foundBeacon);
      var beacon = { lat: foundBeacon.latitude, lng: foundBeacon.longitude };
      // The map, centered at BEACON
      console.log(beacon)
      var map = new google.maps.Map(document.getElementById("beacon-map"), {
        zoom: 12,
        center: beacon
      });
      // The marker, positioned at beacon
      var marker = new google.maps.Marker({ position: beacon, map: map });
    }
  );
}
</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key={{apiKey}}&callback=initMap">
</script>
{{> header}}

<div class="container">

  <div class="details d-flex justify-content-between">
    <div class="details-main">
      <h1>{{beacon.dataValues.title}}</h1>
      <p>
        <a href="/profile/{{beacon.dataValues.User.dataValues.id}}">
          Posted by {{beacon.dataValues.User.dataValues.displayName}}</a>
      </p>
      <p>{{beacon.dataValues.category}}</p>
    </div>

    <div class="details-aside">
      <p>{{beacon.dataValues.address}}</p>
      <p>{{beacon.dataValues.startTime}}</p>
      {{!-- <p>Beacon End Time {{endTime}}</p> --}}
      <p>Beacon Date {{beacon.dataValues.date}}</p>
    </div>

  </div>
  <hr>
  <p class="text-justify">{{beacon.dataValues.description}}</p>

  <div id="beacon-map" style="width: 100%; height: 300px; background: #c2c2c2;"></div>
  {{!-- Comment Form --}}
  <div class="comment-group my-3">
    <form id="form-comment">
      <div class="form-group">
        <label for="body">Leave a Comment</label>
        <textarea class="form-control" name="body" id="body" cols="30"
          rows="4"></textarea>
      </div>
      <input class="btn btn-primary btn-block" id="btn-comment" type="submit"
        value="Submit">
    </form>

    {{!-- Comments --}}
    <div id="comment-container"></div>
  </div>

</div>

{{> footer}}

<script src="/js/comment.js"></script>